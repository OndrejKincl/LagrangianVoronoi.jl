<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example 2: Lid-driven cavity · LagrangianVoronoi.jl</title><meta name="title" content="Example 2: Lid-driven cavity · LagrangianVoronoi.jl"/><meta property="og:title" content="Example 2: Lid-driven cavity · LagrangianVoronoi.jl"/><meta property="twitter:title" content="Example 2: Lid-driven cavity · LagrangianVoronoi.jl"/><meta name="description" content="Documentation for LagrangianVoronoi.jl."/><meta property="og:description" content="Documentation for LagrangianVoronoi.jl."/><meta property="twitter:description" content="Documentation for LagrangianVoronoi.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">LagrangianVoronoi.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="gresho.html">Example 1: Gresho Vortex Benchmark</a></li><li class="is-active"><a class="tocitem" href="cavity.html">Example 2: Lid-driven cavity</a></li><li><a class="tocitem" href="sedov.html">Example 3: Sedov Blast</a></li><li><a class="tocitem" href="doubleshear.html">Example 4: Double Shear Layer</a></li><li><a class="tocitem" href="rayleightaylor.html">Example 5: Rayleigh-Taylor Instability</a></li><li><a class="tocitem" href="triplepoint.html">Example 6: Triple-point problem</a></li><li><a class="tocitem" href="heat.html">Example 7: Rayleigh-Bénard Instability</a></li><li><a class="tocitem" href="taylorgreen.html">Example 8: Taylor-Green Vortex</a></li></ul></li><li><a class="tocitem" href="../api.html">API Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="cavity.html">Example 2: Lid-driven cavity</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="cavity.html">Example 2: Lid-driven cavity</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/OndrejKincl/LagrangianVoronoi.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/OndrejKincl/LagrangianVoronoi.jl/blob/master/docs/src/examples/cavity.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-2:-Lid-driven-cavity"><a class="docs-heading-anchor" href="#Example-2:-Lid-driven-cavity">Example 2: Lid-driven cavity</a><a id="Example-2:-Lid-driven-cavity-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Lid-driven-cavity" title="Permalink"></a></h1>    <img src='../assets/cavity.png' alt='missing' width="50%" height="50%"><br><p>Simulation of a vortex induced by viscosity. The domain is a square</p><p><span>$\Omega = [0,1] \times [0,1]$</span></p><p>with Dirichlet boundary conditions everywhere. The sides and bottom are no-slip condition</p><p><span>$\mathbf{v} = 0, \quad \mathbf{x} \in \Gamma_\mathrm{left}\cup \Gamma_\mathrm{right} \cup \Gamma_\mathrm{bottom}.$</span></p><p>whereas the top side prescribes a uniform velocity in horizontal direction:</p><p><span>$\mathbf{v} = \begin{pmatrix} 1 \\ 0 \end{pmatrix}, \quad \mathbf{x} \in \Gamma_\mathrm{up}.$</span></p><p>The fluid is described by incompressible Navier-Stokes. The solution should be a steady flow, be we can reach it with a dynamic solver by setting sufficiently large <code>t_end</code>. To plot streamlines, open the pvd file in paraview and use the <em>Evenly Spaced Streamlines</em> filter.</p><pre><code class="language-julia hljs">module cavity
include(&quot;../src/LagrangianVoronoi.jl&quot;)
using .LagrangianVoronoi, DataFrames, CSV, Plots</code></pre><p>We will use a strictly incompressible model but using the stiffened gas model with large initial sound speed like <code>c0 = 1e3</code> is also fine.</p><pre><code class="language-julia hljs">const Re = 100 # Reynolds number
const N = 100 # resolution
const dr = 1.0/N
const dt = min(0.1*dr, 0.1*Re*dr^2)
const t_end = 0.1*Re
const export_path = &quot;results/cavity/Re$Re&quot;
const rho0 = 1.0 # fluid density</code></pre><p>Define the boundary condition for velocity and the initial condition. We must specify the density, mass and the dynamic coefficient of viscosity. To get incompressible fluid, we set the initial sound speed (squared) to plus infinity.</p><pre><code class="language-julia hljs">function vDirichlet(x::RealVector)::RealVector
    islid = isapprox(x[2], 1.0, atol = 0.1dr)
    return islid ? VECX : VEC0
end

function ic!(p::VoronoiPolygon)
    p.rho = rho0
    p.mass = p.rho*area(p)
    p.mu = 1.0/Re
    p.c2 = Inf
end

mutable struct Simulation &lt;: SimulationWorkspace
    grid::GridNS
    mesh_quality::Float64
    energy::Float64
    solver::PressureSolver{PolygonNS}
    Simulation() = begin
        domain = UnitRectangle()
        grid = GridNS(domain, dr)
        populate_lloyd!(grid, ic! = ic!)
        return new(grid, 0.0, 0.0, PressureSolver(grid))
    end
end</code></pre><p>When defining the step, we need to activate boundary friction. We omit the equation of state as there is no such thing in the incompressible regime.</p><pre><code class="language-julia hljs">function step!(sim::Simulation, t::Float64)
    move!(sim.grid, dt)
    find_pressure!(sim.solver, dt)
    pressure_step!(sim.grid, dt)
    find_D!(sim.grid)
    viscous_step!(sim.grid, dt; artificial_viscosity = false)
    bdary_friction!(sim.grid, vDirichlet, dt)
    find_dv!(sim.grid, dt)
    relaxation_step!(sim.grid, dt)
    return
end

function postproc!(sim::Simulation, t::Float64)
    sim.mesh_quality = Inf
    for p in sim.grid.polygons
        sim.energy += 0.5*p.mass*norm_squared(p.v)
        sim.mesh_quality = min(sim.mesh_quality, p.quality)
    end
    percent = round(100*t/t_end, digits = 5)
    println(&quot;sim time = $t ($(percent)%)&quot;)
    println(&quot;mesh quality = $(sim.mesh_quality)&quot;)
    println(&quot;kinetic energy = $(sim.energy)&quot;)
    println()
    return
end</code></pre><p>Finally, we declare some functions to extract more data. Namely, we measure the horizontal velocity along the vertical axis and vice versa.</p><pre><code class="language-julia hljs">function compute_fluxes(grid::VoronoiGrid, res = 100)
    s = range(0.,1.,length=res)
    v1 = zeros(res)
    v2 = zeros(res)
    for i in 1:res
        #x-velocity along y-centerline
        x = RealVector(0.5, s[i])
        v1[i] = point_value(grid, x, p -&gt; p.v[1])
        #y-velocity along x-centerline
        x = RealVector(s[i], 0.5)
        v2[i] = point_value(grid, x, p -&gt; p.v[2])
    end
    #save results into csv
    data = DataFrame(s=s, v1=v1, v2=v2)
    CSV.write(joinpath(export_path, &quot;vprofile_legacy.csv&quot;), data)
    make_plot()
end</code></pre><p>The plot of velocity is compared to a reference solution by <a href="https://www.sciencedirect.com/science/article/pii/S1110016816302800">Abdelmigid et al</a>.</p><pre><code class="language-julia hljs">function make_plot()
    ref_x2vy = CSV.read(&quot;reference/ldc_x2vy_abdelmigid.csv&quot;, DataFrame)
    ref_y2vx = CSV.read(&quot;reference/ldc_y2vx_abdelmigid.csv&quot;, DataFrame)
    propertyname = Symbol(&quot;Re&quot;, Re)
    ref_vy = getproperty(ref_x2vy, propertyname)
    ref_vx = getproperty(ref_y2vx, propertyname)
    data = CSV.read(joinpath(export_path, &quot;vprofile.csv&quot;), DataFrame)
    plt = plot(
        data.s, [movingavg(data.v2) movingavg(data.v1)],
        xlabel = &quot;x, y&quot;,
        ylabel = &quot;u, v&quot;,
        label = [&quot;v&quot; &quot;u&quot;],
        linewidth = 2,
        legend = :topleft,
        color = [:orange :royalblue]
    )
    scatter!(plt,
        [ref_x2vy.x ref_y2vx.y], [ref_vy ref_vx],
        label = false,
        color = [:orange :royalblue],
        markersize = 4,
        markerstroke = stroke(1, :black),
        markershape = [:circ :square]
    )
    savefig(plt, joinpath(export_path, &quot;vprofile.pdf&quot;))
end</code></pre><p>Finally, wrap everything into the function main.</p><pre><code class="language-julia hljs">function main()
    sim = Simulation()
    @time run!(
        sim,
        dt,
        t_end,
        step!;
        postproc! = postproc!,
        path = export_path,
        nframes = 200, # number of time frames
        vtp_vars = (:v, :P, :quality), # local variables exported in vtk
        csv_vars = (:energy, :mesh_quality) # global variables exported in csv
    )
    compute_fluxes(sim.grid)
    return
end

if abspath(PROGRAM_FILE) == @__FILE__
    main()
end

end</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="gresho.html">« Example 1: Gresho Vortex Benchmark</a><a class="docs-footer-nextpage" href="sedov.html">Example 3: Sedov Blast »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 26 September 2024 14:59">Thursday 26 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
